{"remainingRequest":"E:\\Downloads\\wiki-dev\\node_modules\\babel-loader\\lib\\index.js??ref--0-1!E:\\Downloads\\wiki-dev\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Downloads\\wiki-dev\\client\\components\\editor\\editor-markdown.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\Downloads\\wiki-dev\\client\\components\\editor\\editor-markdown.vue","mtime":1618944746000},{"path":"E:\\Downloads\\wiki-dev\\.babelrc","mtime":1618944746000},{"path":"E:\\Downloads\\wiki-dev\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618998867176},{"path":"E:\\Downloads\\wiki-dev\\node_modules\\babel-loader\\lib\\index.js","mtime":1617693652020},{"path":"E:\\Downloads\\wiki-dev\\node_modules\\vue-loader\\lib\\index.js","mtime":1618998883415}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zZXQgZnJvbSAibG9kYXNoL3NldCI7CmltcG9ydCBfZmluZExhc3QgZnJvbSAibG9kYXNoL2ZpbmRMYXN0IjsKaW1wb3J0IF9sYXN0IGZyb20gImxvZGFzaC9sYXN0IjsKaW1wb3J0IF9mbGF0dGVuIGZyb20gImxvZGFzaC9mbGF0dGVuIjsKaW1wb3J0IF9nZXQgZnJvbSAibG9kYXNoL2dldCI7CmltcG9ydCBfdGltZXMgZnJvbSAibG9kYXNoL3RpbWVzIjsKaW1wb3J0IF9zdGFydHNXaXRoIGZyb20gImxvZGFzaC9zdGFydHNXaXRoIjsKaW1wb3J0IF9kZWJvdW5jZSBmcm9tICJsb2Rhc2gvZGVib3VuY2UiOwppbXBvcnQgX2VzY2FwZSBmcm9tICJsb2Rhc2gvZXNjYXBlIjsKaW1wb3J0IHsgZ2V0LCBzeW5jIH0gZnJvbSAndnVleC1wYXRoaWZ5JzsKaW1wb3J0IG1hcmtkb3duSGVscCBmcm9tICcuL21hcmtkb3duL2hlbHAudnVlJzsKaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknOwovKiBnbG9iYWwgc2l0ZUNvbmZpZywgc2l0ZUxhbmdzICovCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSU1QT1JUUwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIENvZGUgTWlycm9yCgppbXBvcnQgQ29kZU1pcnJvciBmcm9tICdjb2RlbWlycm9yJzsKaW1wb3J0ICdjb2RlbWlycm9yL2xpYi9jb2RlbWlycm9yLmNzcyc7IC8vIExhbmd1YWdlCgppbXBvcnQgJ2NvZGVtaXJyb3IvbW9kZS9tYXJrZG93bi9tYXJrZG93bi5qcyc7IC8vIEFkZG9ucwoKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL3NlbGVjdGlvbi9hY3RpdmUtbGluZS5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9kaXNwbGF5L2Z1bGxzY3JlZW4uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZGlzcGxheS9mdWxsc2NyZWVuLmNzcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9zZWxlY3Rpb24vbWFyay1zZWxlY3Rpb24uanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vc2VhcmNoL3NlYXJjaGN1cnNvci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9oaW50L3Nob3ctaGludC5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRjb2RlLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2ZvbGQvZm9sZGd1dHRlci5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9mb2xkL2ZvbGRndXR0ZXIuY3NzJzsKaW1wb3J0ICcuL21hcmtkb3duL2ZvbGQnOyAvLyBNYXJrZG93bi1pdAoKaW1wb3J0IE1hcmtkb3duSXQgZnJvbSAnbWFya2Rvd24taXQnOwppbXBvcnQgbWRBdHRycyBmcm9tICdtYXJrZG93bi1pdC1hdHRycyc7CmltcG9ydCBtZEVtb2ppIGZyb20gJ21hcmtkb3duLWl0LWVtb2ppJzsKaW1wb3J0IG1kVGFza0xpc3RzIGZyb20gJ21hcmtkb3duLWl0LXRhc2stbGlzdHMnOwppbXBvcnQgbWRFeHBhbmRUYWJzIGZyb20gJ21hcmtkb3duLWl0LWV4cGFuZC10YWJzJzsKaW1wb3J0IG1kQWJiciBmcm9tICdtYXJrZG93bi1pdC1hYmJyJzsKaW1wb3J0IG1kU3VwIGZyb20gJ21hcmtkb3duLWl0LXN1cCc7CmltcG9ydCBtZFN1YiBmcm9tICdtYXJrZG93bi1pdC1zdWInOwppbXBvcnQgbWRNYXJrIGZyb20gJ21hcmtkb3duLWl0LW1hcmsnOwppbXBvcnQgbWRNdWx0aVRhYmxlIGZyb20gJ21hcmtkb3duLWl0LW11bHRpbWQtdGFibGUnOwppbXBvcnQgbWRGb290bm90ZSBmcm9tICdtYXJrZG93bi1pdC1mb290bm90ZSc7CmltcG9ydCBtZEltc2l6ZSBmcm9tICdtYXJrZG93bi1pdC1pbXNpemUnOwppbXBvcnQga2F0ZXggZnJvbSAna2F0ZXgnOwppbXBvcnQgdW5kZXJsaW5lIGZyb20gJy4uLy4uL2xpYnMvbWFya2Rvd24taXQtdW5kZXJsaW5lJzsKaW1wb3J0ICdrYXRleC9kaXN0L2NvbnRyaWIvbWhjaGVtJzsKaW1wb3J0IHR3ZW1vamkgZnJvbSAndHdlbW9qaSc7CmltcG9ydCBwbGFudHVtbCBmcm9tICcuL21hcmtkb3duL3BsYW50dW1sJzsgLy8gUHJpc20gKFN5bnRheCBIaWdobGlnaHRpbmcpCgppbXBvcnQgUHJpc20gZnJvbSAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLWNvcmUiOyAvLyBNZXJtYWlkCgppbXBvcnQgInByaXNtanMvY29tcG9uZW50cy9wcmlzbS1jbGlrZSI7CmltcG9ydCAicHJpc21qcy9jb21wb25lbnRzL3ByaXNtLW1hcmt1cCI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2xpbmUtbnVtYmVycy9wcmlzbS1saW5lLW51bWJlcnMuY3NzIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvbGluZS1udW1iZXJzL3ByaXNtLWxpbmUtbnVtYmVycyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2F1dG9sb2FkZXIvcHJpc20tYXV0b2xvYWRlciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL25vcm1hbGl6ZS13aGl0ZXNwYWNlL3ByaXNtLW5vcm1hbGl6ZS13aGl0ZXNwYWNlIjsKaW1wb3J0ICJwcmlzbWpzL3BsdWdpbnMvdG9vbGJhci9wcmlzbS10b29sYmFyLmNzcyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL3Rvb2xiYXIvcHJpc20tdG9vbGJhciI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2NvcHktdG8tY2xpcGJvYXJkL3ByaXNtLWNvcHktdG8tY2xpcGJvYXJkIjsKaW1wb3J0ICJwcmlzbWpzL3RoZW1lcy9wcmlzbS10d2lsaWdodC5jc3MiOwppbXBvcnQgbWVybWFpZCBmcm9tICdtZXJtYWlkJzsgLy8gSGVscGVycwoKaW1wb3J0IGthdGV4SGVscGVyIGZyb20gJy4vY29tbW9uL2thdGV4JzsKaW1wb3J0IHRhYnNldEhlbHBlciBmcm9tICcuL21hcmtkb3duL3RhYnNldCc7IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSU5JVAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFBsYXRmb3JtIGRldGVjdGlvbgoKY29uc3QgQ3RybEtleSA9IC9NYWMvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSA/ICdDbWQnIDogJ0N0cmwnOyAvLyBQcmlzbSBDb25maWcKClByaXNtLnBsdWdpbnMuYXV0b2xvYWRlci5sYW5ndWFnZXNfcGF0aCA9ICcvX2Fzc2V0cy9qcy9wcmlzbS8nOwpQcmlzbS5wbHVnaW5zLk5vcm1hbGl6ZVdoaXRlc3BhY2Uuc2V0RGVmYXVsdHMoewogICdyZW1vdmUtdHJhaWxpbmcnOiB0cnVlLAogICdyZW1vdmUtaW5kZW50JzogdHJ1ZSwKICAnbGVmdC10cmltJzogdHJ1ZSwKICAncmlnaHQtdHJpbSc6IHRydWUsCiAgJ3JlbW92ZS1pbml0aWFsLWxpbmUtZmVlZCc6IHRydWUsCiAgJ3RhYnMtdG8tc3BhY2VzJzogMgp9KTsgLy8gTWFya2Rvd24gSW5zdGFuY2UKCmNvbnN0IG1kID0gbmV3IE1hcmtkb3duSXQoewogIGh0bWw6IHRydWUsCiAgYnJlYWtzOiB0cnVlLAogIGxpbmtpZnk6IHRydWUsCiAgdHlwb2dyYXBoeTogdHJ1ZSwKCiAgaGlnaGxpZ2h0KHN0ciwgbGFuZykgewogICAgaWYgKGxhbmcgPT09ICdkaWFncmFtJykgewogICAgICByZXR1cm4gIjxwcmUgY2xhc3M9XCJkaWFncmFtXCI+IiArIEJ1ZmZlci5mcm9tKHN0ciwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkgKyAiPC9wcmU+IjsKICAgIH0gZWxzZSBpZiAoWydtZXJtYWlkJywgJ3BsYW50dW1sJ10uaW5jbHVkZXMobGFuZykpIHsKICAgICAgcmV0dXJuICI8cHJlIGNsYXNzPVwiY29kZWJsb2NrLSIuY29uY2F0KGxhbmcsICJcIj48Y29kZT4iKS5jb25jYXQoX2VzY2FwZShzdHIpLCAiPC9jb2RlPjwvcHJlPiIpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICI8cHJlIGNsYXNzPVwibGluZS1udW1iZXJzXCI+PGNvZGUgY2xhc3M9XCJsYW5ndWFnZS0iLmNvbmNhdChsYW5nLCAiXCI+IikuY29uY2F0KF9lc2NhcGUoc3RyKSwgIjwvY29kZT48L3ByZT4iKTsKICAgIH0KICB9Cgp9KS51c2UobWRBdHRycywgewogIGFsbG93ZWRBdHRyaWJ1dGVzOiBbJ2lkJywgJ2NsYXNzJywgJ3RhcmdldCddCn0pLnVzZSh1bmRlcmxpbmUpLnVzZShtZEVtb2ppKS51c2UobWRUYXNrTGlzdHMsIHsKICBsYWJlbDogdHJ1ZSwKICBsYWJlbEFmdGVyOiB0cnVlCn0pLnVzZShtZEV4cGFuZFRhYnMpLnVzZShtZEFiYnIpLnVzZShtZFN1cCkudXNlKG1kU3ViKS51c2UobWRNdWx0aVRhYmxlLCB7CiAgbXVsdGlsaW5lOiB0cnVlLAogIHJvd3NwYW46IHRydWUsCiAgaGVhZGVybGVzczogdHJ1ZQp9KS51c2UobWRNYXJrKS51c2UobWRGb290bm90ZSkudXNlKG1kSW1zaXplKTsgLy8gRE9NUHVyaWZ5IGZpeCBmb3IgZHJhdy5pbwoKRE9NUHVyaWZ5LmFkZEhvb2soJ3Vwb25TYW5pdGl6ZUVsZW1lbnQnLCBlbG0gPT4gewogIGlmIChlbG0ucXVlcnlTZWxlY3RvckFsbCkgewogICAgY29uc3QgYnJlYWtzID0gZWxtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ZvcmVpZ25PYmplY3QgYnIsIGZvcmVpZ25PYmplY3QgcCcpOwoKICAgIGlmIChicmVha3MgJiYgYnJlYWtzLmxlbmd0aCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJyZWFrcy5sZW5ndGg7IGkrKykgewogICAgICAgIGJyZWFrc1tpXS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwgYnJlYWtzW2ldKTsKICAgICAgfQogICAgfQogIH0KfSk7IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gSEVMUEVSIEZVTkNUSU9OUwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEluamVjdCBsaW5lIG51bWJlcnMgZm9yIHByZXZpZXcgc2Nyb2xsIHN5bmMKCmxldCBsaW5lc01hcCA9IFtdOwoKZnVuY3Rpb24gaW5qZWN0TGluZU51bWJlcnModG9rZW5zLCBpZHgsIG9wdGlvbnMsIGVudiwgc2xmKSB7CiAgbGV0IGxpbmU7CgogIGlmICh0b2tlbnNbaWR4XS5tYXAgJiYgdG9rZW5zW2lkeF0ubGV2ZWwgPT09IDApIHsKICAgIGxpbmUgPSB0b2tlbnNbaWR4XS5tYXBbMF07CiAgICB0b2tlbnNbaWR4XS5hdHRySm9pbignY2xhc3MnLCAnbGluZScpOwogICAgdG9rZW5zW2lkeF0uYXR0clNldCgnZGF0YS1saW5lJywgU3RyaW5nKGxpbmUpKTsKICAgIGxpbmVzTWFwLnB1c2gobGluZSk7CiAgfQoKICByZXR1cm4gc2xmLnJlbmRlclRva2VuKHRva2VucywgaWR4LCBvcHRpb25zLCBlbnYsIHNsZik7Cn0KCm1kLnJlbmRlcmVyLnJ1bGVzLnBhcmFncmFwaF9vcGVuID0gaW5qZWN0TGluZU51bWJlcnM7Cm1kLnJlbmRlcmVyLnJ1bGVzLmhlYWRpbmdfb3BlbiA9IGluamVjdExpbmVOdW1iZXJzOwptZC5yZW5kZXJlci5ydWxlcy5ibG9ja3F1b3RlX29wZW4gPSBpbmplY3RMaW5lTnVtYmVyczsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBQTEFOVFVNTAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIFRPRE86IFVzZSBzYW1lIG9wdGlvbnMgYXMgZGVmaW5lZCBpbiBiYWNrZW5kCgpwbGFudHVtbC5pbml0KG1kLCB7fSk7IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gS0FURVgKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKbWQuaW5saW5lLnJ1bGVyLmFmdGVyKCdlc2NhcGUnLCAna2F0ZXhfaW5saW5lJywga2F0ZXhIZWxwZXIua2F0ZXhJbmxpbmUpOwoKbWQucmVuZGVyZXIucnVsZXMua2F0ZXhfaW5saW5lID0gKHRva2VucywgaWR4KSA9PiB7CiAgdHJ5IHsKICAgIHJldHVybiBrYXRleC5yZW5kZXJUb1N0cmluZyh0b2tlbnNbaWR4XS5jb250ZW50LCB7CiAgICAgIGRpc3BsYXlNb2RlOiBmYWxzZQogICAgfSk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsKCm1kLmJsb2NrLnJ1bGVyLmFmdGVyKCdibG9ja3F1b3RlJywgJ2thdGV4X2Jsb2NrJywga2F0ZXhIZWxwZXIua2F0ZXhCbG9jaywgewogIGFsdDogWydwYXJhZ3JhcGgnLCAncmVmZXJlbmNlJywgJ2Jsb2NrcXVvdGUnLCAnbGlzdCddCn0pOwoKbWQucmVuZGVyZXIucnVsZXMua2F0ZXhfYmxvY2sgPSAodG9rZW5zLCBpZHgpID0+IHsKICB0cnkgewogICAgcmV0dXJuICI8cD4iICsga2F0ZXgucmVuZGVyVG9TdHJpbmcodG9rZW5zW2lkeF0uY29udGVudCwgewogICAgICBkaXNwbGF5TW9kZTogdHJ1ZQogICAgfSkgKyAiPC9wPiI7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBUV0VNT0pJCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgptZC5yZW5kZXJlci5ydWxlcy5lbW9qaSA9ICh0b2tlbiwgaWR4KSA9PiB7CiAgcmV0dXJuIHR3ZW1vamkucGFyc2UodG9rZW5baWR4XS5jb250ZW50LCB7CiAgICBjYWxsYmFjayhpY29uLCBvcHRzKSB7CiAgICAgIHJldHVybiAiL19hc3NldHMvc3ZnL3R3ZW1vamkvIi5jb25jYXQoaWNvbiwgIi5zdmciKTsKICAgIH0KCiAgfSk7Cn07IC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gVnVlIENvbXBvbmVudAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgoKbGV0IG1lcm1haWRJZCA9IDA7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBtYXJrZG93bkhlbHAKICB9LAogIHByb3BzOiB7CiAgICBzYXZlOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uLAogICAgICBkZWZhdWx0OiAoKSA9PiB7fQogICAgfQogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBmYWJJbnNlcnRNZW51OiBmYWxzZSwKICAgICAgY206IG51bGwsCiAgICAgIGN1cnNvclBvczogewogICAgICAgIGNoOiAwLAogICAgICAgIGxpbmU6IDEKICAgICAgfSwKICAgICAgcHJldmlld1Nob3duOiB0cnVlLAogICAgICBwcmV2aWV3SFRNTDogJycsCiAgICAgIGhlbHBTaG93bjogZmFsc2UsCiAgICAgIHNwZWxsTW9kZUFjdGl2ZTogZmFsc2UsCiAgICAgIGluc2VydExpbmtEaWFsb2c6IGZhbHNlCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBpc01vYmlsZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHZ1ZXRpZnkuYnJlYWtwb2ludC5zbUFuZERvd247CiAgICB9LAoKICAgIGlzTW9kYWxTaG93bigpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVscFNob3duIHx8IHRoaXMuYWN0aXZlTW9kYWwgIT09ICcnOwogICAgfSwKCiAgICBsb2NhbGU6IGdldCgncGFnZS9sb2NhbGUnKSwKICAgIHBhdGg6IGdldCgncGFnZS9wYXRoJyksCiAgICBtb2RlOiBnZXQoJ2VkaXRvci9tb2RlJyksCiAgICBhY3RpdmVNb2RhbDogc3luYygnZWRpdG9yL2FjdGl2ZU1vZGFsJykKICB9LAogIHdhdGNoOiB7CiAgICBwcmV2aWV3U2hvd24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICAgIGlmIChuZXdWYWx1ZSAmJiAhb2xkVmFsdWUpIHsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLnJlbmRlck1lcm1haWREaWFncmFtcygpOwogICAgICAgICAgUHJpc20uaGlnaGxpZ2h0QWxsVW5kZXIodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3KTsKICAgICAgICAgIEFycmF5LmZyb20odGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZS5saW5lLW51bWJlcnMnKSkuZm9yRWFjaChwcmUgPT4gcHJlLmNsYXNzTGlzdC5hZGQoJ3ByaXNtanMnKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgc3BlbGxNb2RlQWN0aXZlKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgICBpZiAobmV3VmFsdWUpIHsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcuZm9jdXMoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICB9LAogIG1ldGhvZHM6IHsKICAgIHRvZ2dsZU1vZGFsKGtleSkgewogICAgICB0aGlzLmFjdGl2ZU1vZGFsID0gdGhpcy5hY3RpdmVNb2RhbCA9PT0ga2V5ID8gJycgOiBrZXk7CiAgICAgIHRoaXMuaGVscFNob3duID0gZmFsc2U7CiAgICB9LAoKICAgIGNsb3NlQWxsTW9kYWwoKSB7CiAgICAgIHRoaXMuYWN0aXZlTW9kYWwgPSAnJzsKICAgICAgdGhpcy5oZWxwU2hvd24gPSBmYWxzZTsKICAgIH0sCgogICAgb25DbUlucHV0OiBfZGVib3VuY2UoZnVuY3Rpb24gKG5ld0NvbnRlbnQpIHsKICAgICAgdGhpcy5wcm9jZXNzQ29udGVudChuZXdDb250ZW50KTsKICAgIH0sIDYwMCksCgogICAgb25DbVBhc3RlKGNtLCBldikgey8vIGNvbnN0IGNsaXBJdGVtcyA9IChldi5jbGlwYm9hcmREYXRhIHx8IGV2Lm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YSkuaXRlbXMKICAgICAgLy8gZm9yIChsZXQgY2xpcEl0ZW0gb2YgY2xpcEl0ZW1zKSB7CiAgICAgIC8vICAgaWYgKF8uc3RhcnRzV2l0aChjbGlwSXRlbS50eXBlLCAnaW1hZ2UvJykpIHsKICAgICAgLy8gICAgIGNvbnN0IGZpbGUgPSBjbGlwSXRlbS5nZXRBc0ZpbGUoKQogICAgICAvLyAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKQogICAgICAvLyAgICAgcmVhZGVyLm9ubG9hZCA9IGV2dCA9PiB7CiAgICAgIC8vICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdChgbG9hZGluZ1N0YXJ0YCwgJ2VkaXRvci1wYXN0ZS1pbWFnZScpCiAgICAgIC8vICAgICAgIHRoaXMuaW5zZXJ0QWZ0ZXIoewogICAgICAvLyAgICAgICAgIGNvbnRlbnQ6IGAhWyR7ZmlsZS5uYW1lfV0oJHtldnQudGFyZ2V0LnJlc3VsdH0pYCwKICAgICAgLy8gICAgICAgICBuZXdMaW5lOiB0cnVlCiAgICAgIC8vICAgICAgIH0pCiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKQogICAgICAvLyAgIH0KICAgICAgLy8gfQogICAgfSwKCiAgICBwcm9jZXNzQ29udGVudChuZXdDb250ZW50KSB7CiAgICAgIGxpbmVzTWFwID0gW107IC8vIHRoaXMuJHN0b3JlLnNldCgnZWRpdG9yL2NvbnRlbnQnLCBuZXdDb250ZW50KQoKICAgICAgdGhpcy5wcm9jZXNzTWFya2Vycyh0aGlzLmNtLmZpcnN0TGluZSgpLCB0aGlzLmNtLmxhc3RMaW5lKCkpOwogICAgICB0aGlzLnByZXZpZXdIVE1MID0gRE9NUHVyaWZ5LnNhbml0aXplKG1kLnJlbmRlcihuZXdDb250ZW50KSwgewogICAgICAgIEFERF9UQUdTOiBbJ2ZvcmVpZ25PYmplY3QnXQogICAgICB9KTsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIHRhYnNldEhlbHBlci5mb3JtYXQoKTsKICAgICAgICB0aGlzLnJlbmRlck1lcm1haWREaWFncmFtcygpOwogICAgICAgIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyKHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldyk7CiAgICAgICAgQXJyYXkuZnJvbSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcucXVlcnlTZWxlY3RvckFsbCgncHJlLmxpbmUtbnVtYmVycycpKS5mb3JFYWNoKHByZSA9PiBwcmUuY2xhc3NMaXN0LmFkZCgncHJpc21qcycpKTsKICAgICAgICB0aGlzLnNjcm9sbFN5bmModGhpcy5jbSk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIFVwZGF0ZSBjdXJzb3Igc3RhdGUKICAgICAqLwogICAgcG9zaXRpb25TeW5jKGNtKSB7CiAgICAgIHRoaXMuY3Vyc29yUG9zID0gY20uZ2V0Q3Vyc29yKCdoZWFkJyk7CiAgICB9LAoKICAgIC8qKgogICAgICogV3JhcCBzZWxlY3Rpb24gd2l0aCBzdGFydCAvIGVuZCB0YWdzCiAgICAgKi8KICAgIHRvZ2dsZU1hcmt1cCh7CiAgICAgIHN0YXJ0LAogICAgICBlbmQKICAgIH0pIHsKICAgICAgaWYgKCFlbmQpIHsKICAgICAgICBlbmQgPSBzdGFydDsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmNtLmRvYy5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2hvd05vdGlmaWNhdGlvbicsIHsKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoJ2VkaXRvcjptYXJrdXAubm9TZWxlY3Rpb25FcnJvcicpLAogICAgICAgICAgc3R5bGU6ICd3YXJuaW5nJywKICAgICAgICAgIGljb246ICd3YXJuaW5nJwogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLmNtLmRvYy5yZXBsYWNlU2VsZWN0aW9ucyh0aGlzLmNtLmRvYy5nZXRTZWxlY3Rpb25zKCkubWFwKHMgPT4gc3RhcnQgKyBzICsgZW5kKSk7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0IGN1cnJlbnQgbGluZSBhcyBoZWFkZXIKICAgICAqLwogICAgc2V0SGVhZGVyTGluZShsdmwpIHsKICAgICAgY29uc3QgY3VyTGluZSA9IHRoaXMuY20uZG9jLmdldEN1cnNvcignaGVhZCcpLmxpbmU7CiAgICAgIGxldCBsaW5lQ29udGVudCA9IHRoaXMuY20uZG9jLmdldExpbmUoY3VyTGluZSk7CiAgICAgIGNvbnN0IGxpbmVMZW5ndGggPSBsaW5lQ29udGVudC5sZW5ndGg7CgogICAgICBpZiAoX3N0YXJ0c1dpdGgobGluZUNvbnRlbnQsICcjJykpIHsKICAgICAgICBsaW5lQ29udGVudCA9IGxpbmVDb250ZW50LnJlcGxhY2UoL14oIysgKS8sICcnKTsKICAgICAgfQoKICAgICAgbGluZUNvbnRlbnQgPSBfdGltZXMobHZsLCBuID0+ICcjJykuam9pbignJykgKyAiICIgKyBsaW5lQ29udGVudDsKICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKGxpbmVDb250ZW50LCB7CiAgICAgICAgbGluZTogY3VyTGluZSwKICAgICAgICBjaDogMAogICAgICB9LCB7CiAgICAgICAgbGluZTogY3VyTGluZSwKICAgICAgICBjaDogbGluZUxlbmd0aAogICAgICB9KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlYWRlciBsZXZlciBvZiB0aGUgY3VycmVudCBsaW5lCiAgICAgKi8KICAgIGdldEhlYWRlckxldmVsKGNtKSB7CiAgICAgIGNvbnN0IGN1ckxpbmUgPSB0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKS5saW5lOwogICAgICBsZXQgbGluZUNvbnRlbnQgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGN1ckxpbmUpOwogICAgICBsZXQgbHZsID0gMDsKICAgICAgY29uc3QgcmVzdWx0ID0gbGluZUNvbnRlbnQubWF0Y2goL14oIyspIC8pOwoKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIGx2bCA9IF9nZXQocmVzdWx0LCAnWzFdJywgJycpLmxlbmd0aDsKICAgICAgfQoKICAgICAgcmV0dXJuIGx2bDsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgY29udGVudCBhdCBjdXJzb3IKICAgICAqLwogICAgaW5zZXJ0QXRDdXJzb3IoewogICAgICBjb250ZW50CiAgICB9KSB7CiAgICAgIGNvbnN0IGN1cnNvciA9IHRoaXMuY20uZG9jLmdldEN1cnNvcignaGVhZCcpOwogICAgICB0aGlzLmNtLmRvYy5yZXBsYWNlUmFuZ2UoY29udGVudCwgY3Vyc29yKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBJbnNlcnQgY29udGVudCBhZnRlciBjdXJyZW50IGxpbmUKICAgICAqLwogICAgaW5zZXJ0QWZ0ZXIoewogICAgICBjb250ZW50LAogICAgICBuZXdMaW5lCiAgICB9KSB7CiAgICAgIGNvbnN0IGN1ckxpbmUgPSB0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ3RvJykubGluZTsKICAgICAgY29uc3QgbGluZUxlbmd0aCA9IHRoaXMuY20uZG9jLmdldExpbmUoY3VyTGluZSkubGVuZ3RoOwogICAgICB0aGlzLmNtLmRvYy5yZXBsYWNlUmFuZ2UobmV3TGluZSA/ICJcbiIuY29uY2F0KGNvbnRlbnQsICJcbiIpIDogY29udGVudCwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IGxpbmVMZW5ndGggKyAxCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioKICAgICAqIEluc2VydCBjb250ZW50IGJlZm9yZSBjdXJyZW50IGxpbmUKICAgICAqLwogICAgaW5zZXJ0QmVmb3JlRWFjaExpbmUoewogICAgICBjb250ZW50LAogICAgICBhZnRlcgogICAgfSkgewogICAgICBsZXQgbGluZXMgPSBbXTsKCiAgICAgIGlmICghdGhpcy5jbS5kb2Muc29tZXRoaW5nU2VsZWN0ZWQoKSkgewogICAgICAgIGxpbmVzLnB1c2godGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJykubGluZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGluZXMgPSBfZmxhdHRlbih0aGlzLmNtLmRvYy5saXN0U2VsZWN0aW9ucygpLm1hcChzbCA9PiB7CiAgICAgICAgICBjb25zdCByYW5nZSA9IE1hdGguYWJzKHNsLmFuY2hvci5saW5lIC0gc2wuaGVhZC5saW5lKSArIDE7CiAgICAgICAgICBjb25zdCBsb3dlc3RMaW5lID0gc2wuYW5jaG9yLmxpbmUgPiBzbC5oZWFkLmxpbmUgPyBzbC5oZWFkLmxpbmUgOiBzbC5hbmNob3IubGluZTsKICAgICAgICAgIHJldHVybiBfdGltZXMocmFuZ2UsIGwgPT4gbCArIGxvd2VzdExpbmUpOwogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgbGluZXMuZm9yRWFjaChsbiA9PiB7CiAgICAgICAgbGV0IGxpbmVDb250ZW50ID0gdGhpcy5jbS5kb2MuZ2V0TGluZShsbik7CiAgICAgICAgY29uc3QgbGluZUxlbmd0aCA9IGxpbmVDb250ZW50Lmxlbmd0aDsKCiAgICAgICAgaWYgKF9zdGFydHNXaXRoKGxpbmVDb250ZW50LCBjb250ZW50KSkgewogICAgICAgICAgbGluZUNvbnRlbnQgPSBsaW5lQ29udGVudC5zdWJzdHJpbmcoY29udGVudC5sZW5ndGgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKGNvbnRlbnQgKyBsaW5lQ29udGVudCwgewogICAgICAgICAgbGluZTogbG4sCiAgICAgICAgICBjaDogMAogICAgICAgIH0sIHsKICAgICAgICAgIGxpbmU6IGxuLAogICAgICAgICAgY2g6IGxpbmVMZW5ndGgKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBpZiAoYWZ0ZXIpIHsKICAgICAgICBjb25zdCBsYXN0TGluZSA9IF9sYXN0KGxpbmVzKTsKCiAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKCJcbiIuY29uY2F0KGFmdGVyLCAiXG4iKSwgewogICAgICAgICAgbGluZTogbGFzdExpbmUsCiAgICAgICAgICBjaDogdGhpcy5jbS5kb2MuZ2V0TGluZShsYXN0TGluZSkubGVuZ3RoICsgMQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKgogICAgICogVXBkYXRlIHNjcm9sbCBzeW5jCiAgICAgKi8KICAgIHNjcm9sbFN5bmM6IF9kZWJvdW5jZShmdW5jdGlvbiAoY20pIHsKICAgICAgaWYgKCF0aGlzLnByZXZpZXdTaG93biB8fCBjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgY3VycmVudExpbmUgPSBjbS5nZXRDdXJzb3IoKS5saW5lOwoKICAgICAgaWYgKGN1cnJlbnRMaW5lIDwgMykgewogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LCAnc3RvcCcsIHRydWUpOwogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LmZpcnN0Q2hpbGQsICdzY3JvbGwnLCB7CiAgICAgICAgICBvZmZzZXQ6ICctNTAnLAogICAgICAgICAgZHVyYXRpb246IDEwMDAsCiAgICAgICAgICBjb250YWluZXI6IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlld0NvbnRhaW5lcgogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBjbG9zZXN0TGluZSA9IF9maW5kTGFzdChsaW5lc01hcCwgbiA9PiBuIDw9IGN1cnJlbnRMaW5lKTsKCiAgICAgICAgbGV0IGRlc3RFbG0gPSB0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcucXVlcnlTZWxlY3RvcigiW2RhdGEtbGluZT0nIi5jb25jYXQoY2xvc2VzdExpbmUsICInXSIpKTsKCiAgICAgICAgaWYgKGRlc3RFbG0pIHsKICAgICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LCAnc3RvcCcsIHRydWUpOwogICAgICAgICAgdGhpcy5WZWxvY2l0eShkZXN0RWxtLCAnc2Nyb2xsJywgewogICAgICAgICAgICBvZmZzZXQ6ICctMTAwJywKICAgICAgICAgICAgZHVyYXRpb246IDEwMDAsCiAgICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3Q29udGFpbmVyCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIDUwMCksCgogICAgdG9nZ2xlSGVscCgpIHsKICAgICAgdGhpcy5oZWxwU2hvd24gPSAhdGhpcy5oZWxwU2hvd247CiAgICAgIHRoaXMuYWN0aXZlTW9kYWwgPSAnJzsKICAgIH0sCgogICAgdG9nZ2xlRnVsbHNjcmVlbigpIHsKICAgICAgdGhpcy5jbS5zZXRPcHRpb24oJ2Z1bGxTY3JlZW4nLCB0cnVlKTsKICAgIH0sCgogICAgcmVmcmVzaCgpIHsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIHRoaXMuY20ucmVmcmVzaCgpOwogICAgICB9KTsKICAgIH0sCgogICAgcmVuZGVyTWVybWFpZERpYWdyYW1zKCkgewogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZWRpdG9yLW1hcmtkb3duLXByZXZpZXcgcHJlLmNvZGVibG9jay1tZXJtYWlkID4gY29kZScpLmZvckVhY2goZWxtID0+IHsKICAgICAgICBtZXJtYWlkSWQrKzsKICAgICAgICBjb25zdCBtZXJtYWlkRGVmID0gZWxtLmlubmVyVGV4dDsKICAgICAgICBjb25zdCBtbUVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIG1tRWxtLmlubmVySFRNTCA9ICI8ZGl2IGlkPVwibWVybWFpZC1pZC0iLmNvbmNhdChtZXJtYWlkSWQsICJcIj4iKS5jb25jYXQobWVybWFpZC5yZW5kZXIoIm1lcm1haWQtaWQtIi5jb25jYXQobWVybWFpZElkKSwgbWVybWFpZERlZiksICI8L2Rpdj4iKTsKICAgICAgICBlbG0ucGFyZW50RWxlbWVudC5yZXBsYWNlV2l0aChtbUVsbSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBhdXRvY29tcGxldGUoY20sIGNoYW5nZSkgewogICAgICBpZiAoY20uZ2V0TW9kZUF0KGNtLmdldEN1cnNvcigpKS5uYW1lICE9PSAnbWFya2Rvd24nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIExpbmtzCgoKICAgICAgaWYgKGNoYW5nZS50ZXh0WzBdID09PSAnKCcpIHsKICAgICAgICBjb25zdCBjdXJMaW5lID0gY20uZ2V0TGluZShjaGFuZ2UuZnJvbS5saW5lKS5zdWJzdHJpbmcoMCwgY2hhbmdlLmZyb20uY2gpOwoKICAgICAgICBpZiAoY3VyTGluZVtjdXJMaW5lLmxlbmd0aCAtIDFdID09PSAnXScpIHsKICAgICAgICAgIGNtLnNob3dIaW50KHsKICAgICAgICAgICAgaGludDogYXN5bmMgKGNtLCBvcHRpb25zKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgY3VyID0gY20uZ2V0Q3Vyc29yKCk7CiAgICAgICAgICAgICAgY29uc3QgY3VyTGluZSA9IGNtLmdldExpbmUoY3VyLmxpbmUpLnN1YnN0cmluZygwLCBjdXIuY2gpOwogICAgICAgICAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gY3VyTGluZS5zdWJzdHJpbmcoY3VyTGluZS5sYXN0SW5kZXhPZignWycpICsgMSwgY3VyTGluZS5sZW5ndGggLSAyKTsKICAgICAgICAgICAgICBjb25zdCB0b2tlbiA9IGNtLmdldFRva2VuQXQoY3VyKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BSYXcgPSBhd2FpdCB0aGlzLiRhcG9sbG8ucXVlcnkoewogICAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICAgICJraW5kIjogIkRvY3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAiZGVmaW5pdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiT3BlcmF0aW9uRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAib3BlcmF0aW9uIjogInF1ZXJ5IiwKICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZURlZmluaXRpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTm9uTnVsbFR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZWRUeXBlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWVkVHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJTZWxlY3Rpb25TZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicGFnZXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAic2VhcmNoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJBcmd1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkFyZ3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicmVzdWx0cyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInRpdGxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAibG9jYWxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ0b3RhbEhpdHMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICJsb2MiOiB7CiAgICAgICAgICAgICAgICAgICAgICAic3RhcnQiOiAwLAogICAgICAgICAgICAgICAgICAgICAgImVuZCI6IDQ0OSwKICAgICAgICAgICAgICAgICAgICAgICJzb3VyY2UiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJib2R5IjogIlxuICAgICAgICAgICAgICAgICAgICBxdWVyeSAoJHF1ZXJ5OiBTdHJpbmchLCAkbG9jYWxlOiBTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlcyB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2gocXVlcnk6JHF1ZXJ5LCBsb2NhbGU6JGxvY2FsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEhpdHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICIsCiAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkdyYXBoUUwgcmVxdWVzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJsb2NhdGlvbk9mZnNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAibGluZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgImNvbHVtbiI6IDEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5U3RyaW5nLAogICAgICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5sb2NhbGUKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZmV0Y2hQb2xpY3k6ICdjYWNoZS1maXJzdCcKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3AgPSBfZ2V0KHJlc3BSYXcsICdkYXRhLnBhZ2VzLnNlYXJjaCcsIHt9KTsKCiAgICAgICAgICAgICAgICBpZiAocmVzcCAmJiByZXNwLnRvdGFsSGl0cyA+IDApIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBsaXN0OiByZXNwLnJlc3VsdHMubWFwKHIgPT4gKHsKICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICcoJyArIChzaXRlTGFuZ3MubGVuZ3RoID4gMCA/ICIvIi5jb25jYXQoci5sb2NhbGUsICIvIikuY29uY2F0KHIucGF0aCkgOiAiLyIuY29uY2F0KHIucGF0aCkpICsgJyknLAogICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVRleHQ6IHNpdGVMYW5ncy5sZW5ndGggPiAwID8gIi8iLmNvbmNhdChyLmxvY2FsZSwgIi8iKS5jb25jYXQoci5wYXRoLCAiIC0gIikuY29uY2F0KHIudGl0bGUpIDogIi8iLmNvbmNhdChyLnBhdGgsICIgLSAiKS5jb25jYXQoci50aXRsZSkKICAgICAgICAgICAgICAgICAgICB9KSksCiAgICAgICAgICAgICAgICAgICAgZnJvbTogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLnN0YXJ0KSwKICAgICAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CgogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBsaXN0OiBbXSwKICAgICAgICAgICAgICAgIGZyb206IENvZGVNaXJyb3IuUG9zKGN1ci5saW5lLCB0b2tlbi5zdGFydCksCiAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgaW5zZXJ0TGluaygpIHsKICAgICAgdGhpcy5pbnNlcnRMaW5rRGlhbG9nID0gdHJ1ZTsKICAgIH0sCgogICAgaW5zZXJ0TGlua0hhbmRsZXIoewogICAgICBsb2NhbGUsCiAgICAgIHBhdGgKICAgIH0pIHsKICAgICAgY29uc3QgbGFzdFBhcnQgPSBfbGFzdChwYXRoLnNwbGl0KCcvJykpOwoKICAgICAgdGhpcy5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgY29udGVudDogc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyAiWyIuY29uY2F0KGxhc3RQYXJ0LCAiXSgvIikuY29uY2F0KGxvY2FsZSwgIi8iKS5jb25jYXQocGF0aCwgIikiKSA6ICJbIi5jb25jYXQobGFzdFBhcnQsICJdKC8iKS5jb25jYXQocGF0aCwgIikiKQogICAgICB9KTsKICAgIH0sCgogICAgcHJvY2Vzc01hcmtlcnMoZnJvbSwgdG8pIHsKICAgICAgbGV0IGZvdW5kID0gbnVsbDsKICAgICAgbGV0IGZvdW5kU3RhcnQgPSAwOwogICAgICB0aGlzLmNtLmRvYy5nZXRBbGxNYXJrcygpLmZvckVhY2gobWsgPT4gewogICAgICAgIGlmIChtay5fX2tpbmQpIHsKICAgICAgICAgIG1rLmNsZWFyKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jbS5lYWNoTGluZShmcm9tLCB0bywgbG4gPT4gewogICAgICAgIGNvbnN0IGxpbmUgPSBsbi5saW5lTm8oKTsKCiAgICAgICAgaWYgKGxuLnRleHQuc3RhcnRzV2l0aCgnYGBgZGlhZ3JhbScpKSB7CiAgICAgICAgICBmb3VuZCA9ICdkaWFncmFtJzsKICAgICAgICAgIGZvdW5kU3RhcnQgPSBsaW5lOwogICAgICAgIH0gZWxzZSBpZiAobG4udGV4dCA9PT0gJ2BgYCcgJiYgZm91bmQpIHsKICAgICAgICAgIHN3aXRjaCAoZm91bmQpIHsKICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIC8vIC0+IERJQUdSQU0KICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgIGNhc2UgJ2RpYWdyYW0nOgogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmIChsaW5lIC0gZm91bmRTdGFydCAhPT0gMikgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5hZGRNYXJrZXIoewogICAgICAgICAgICAgICAgICBraW5kOiAnZGlhZ3JhbScsCiAgICAgICAgICAgICAgICAgIGZyb206IHsKICAgICAgICAgICAgICAgICAgICBsaW5lOiBmb3VuZFN0YXJ0LAogICAgICAgICAgICAgICAgICAgIGNoOiAzCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRvOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZTogZm91bmRTdGFydCwKICAgICAgICAgICAgICAgICAgICBjaDogMTAKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgdGV4dDogJ0VkaXQgRGlhZ3JhbScsCiAgICAgICAgICAgICAgICAgIGFjdGlvbjogKChzdGFydCwgZW5kKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ID0+IHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY20uZG9jLnNldFNlbGVjdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmU6IHN0YXJ0LAogICAgICAgICAgICAgICAgICAgICAgICBjaDogMAogICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBlbmQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNoOiAzCiAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYXcgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGVuZCAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9hY3RpdmVNb2RhbERhdGEnLCBCdWZmZXIuZnJvbShyYXcsICdiYXNlNjQnKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVNb2RhbCgiZWRpdG9yTW9kYWxEcmF3aW8iKTsKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcHJvY2VzcyBkaWFncmFtIGRhdGEuJywKICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KShmb3VuZFN0YXJ0LCBsaW5lKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKGxuLmhlaWdodCA+IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5jbS5mb2xkQ29kZShmb3VuZFN0YXJ0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSBudWxsOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGFkZE1hcmtlcih7CiAgICAgIGtpbmQsCiAgICAgIGZyb20sCiAgICAgIHRvLAogICAgICB0ZXh0LAogICAgICBhY3Rpb24KICAgIH0pIHsKICAgICAgY29uc3QgbWFya2VyRWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICBtYXJrZXJFbG0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpOwogICAgICBtYXJrZXJFbG0uY2xhc3NOYW1lID0gJ0NvZGVNaXJyb3ItYnV0dG9ubWFya2VyJzsKICAgICAgbWFya2VyRWxtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWN0aW9uKTsKICAgICAgdGhpcy5jbS5tYXJrVGV4dChmcm9tLCB0bywgewogICAgICAgIHJlcGxhY2VkV2l0aDogbWFya2VyRWxtLAogICAgICAgIF9fa2luZDoga2luZAogICAgICB9KTsKICAgIH0KCiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuJHN0b3JlLnNldCgnZWRpdG9yL2VkaXRvcktleScsICdtYXJrZG93bicpOwoKICAgIGlmICh0aGlzLm1vZGUgPT09ICdjcmVhdGUnICYmICF0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpIHsKICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsICcjIEhlYWRlclxuWW91ciBjb250ZW50IGhlcmUnKTsKICAgIH0gLy8gSW5pdGlhbGl6ZSBNZXJtYWlkIEFQSQoKCiAgICBtZXJtYWlkLmluaXRpYWxpemUoewogICAgICBzdGFydE9uTG9hZDogZmFsc2UsCiAgICAgIHRoZW1lOiB0aGlzLiR2dWV0aWZ5LnRoZW1lLmRhcmsgPyAiZGFyayIgOiAiZGVmYXVsdCIKICAgIH0pOyAvLyBJbml0aWFsaXplIENvZGVNaXJyb3IKCiAgICB0aGlzLmNtID0gQ29kZU1pcnJvci5mcm9tVGV4dEFyZWEodGhpcy4kcmVmcy5jbSwgewogICAgICB0YWJTaXplOiAyLAogICAgICBtb2RlOiAndGV4dC9tYXJrZG93bicsCiAgICAgIHRoZW1lOiAnd2lraWpzLWRhcmsnLAogICAgICBsaW5lTnVtYmVyczogdHJ1ZSwKICAgICAgbGluZVdyYXBwaW5nOiB0cnVlLAogICAgICBsaW5lOiB0cnVlLAogICAgICBzdHlsZUFjdGl2ZUxpbmU6IHRydWUsCiAgICAgIGhpZ2hsaWdodFNlbGVjdGlvbk1hdGNoZXM6IHsKICAgICAgICBhbm5vdGF0ZVNjcm9sbGJhcjogdHJ1ZQogICAgICB9LAogICAgICB2aWV3cG9ydE1hcmdpbjogNTAsCiAgICAgIGlucHV0U3R5bGU6ICdjb250ZW50ZWRpdGFibGUnLAogICAgICBhbGxvd0Ryb3BGaWxlVHlwZXM6IFsnaW1hZ2UvanBnJywgJ2ltYWdlL3BuZycsICdpbWFnZS9zdmcnLCAnaW1hZ2UvanBlZycsICdpbWFnZS9naWYnXSwKICAgICAgZGlyZWN0aW9uOiBzaXRlQ29uZmlnLnJ0bCA/ICdydGwnIDogJ2x0cicsCiAgICAgIGZvbGRHdXR0ZXI6IHRydWUsCiAgICAgIGd1dHRlcnM6IFsnQ29kZU1pcnJvci1saW5lbnVtYmVycycsICdDb2RlTWlycm9yLWZvbGRndXR0ZXInXQogICAgfSk7CiAgICB0aGlzLmNtLnNldFZhbHVlKHRoaXMuJHN0b3JlLmdldCgnZWRpdG9yL2NvbnRlbnQnKSk7CiAgICB0aGlzLmNtLm9uKCdjaGFuZ2UnLCBjID0+IHsKICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsIGMuZ2V0VmFsdWUoKSk7CiAgICAgIHRoaXMub25DbUlucHV0KHRoaXMuJHN0b3JlLmdldCgnZWRpdG9yL2NvbnRlbnQnKSk7CiAgICB9KTsKCiAgICBpZiAodGhpcy4kdnVldGlmeS5icmVha3BvaW50Lm1kQW5kVXApIHsKICAgICAgdGhpcy5jbS5zZXRTaXplKG51bGwsICdjYWxjKDEwMHZoIC0gMTEycHggLSAyNHB4KScpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5jbS5zZXRTaXplKG51bGwsICdjYWxjKDEwMHZoIC0gMTEycHggLSAxNnB4KScpOwogICAgfSAvLyBTZXQgS2V5YmluZGluZ3MKCgogICAgY29uc3Qga2V5QmluZGluZ3MgPSB7CiAgICAgICdGMTEnKGMpIHsKICAgICAgICBjLnNldE9wdGlvbignZnVsbFNjcmVlbicsICFjLmdldE9wdGlvbignZnVsbFNjcmVlbicpKTsKICAgICAgfSwKCiAgICAgICdFc2MnKGMpIHsKICAgICAgICBpZiAoYy5nZXRPcHRpb24oJ2Z1bGxTY3JlZW4nKSkgYy5zZXRPcHRpb24oJ2Z1bGxTY3JlZW4nLCBmYWxzZSk7CiAgICAgIH0KCiAgICB9OwoKICAgIF9zZXQoa2V5QmluZGluZ3MsICIiLmNvbmNhdChDdHJsS2V5LCAiLVMiKSwgYyA9PiB7CiAgICAgIHRoaXMuc2F2ZSgpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCAiIi5jb25jYXQoQ3RybEtleSwgIi1CIiksIGMgPT4gewogICAgICB0aGlzLnRvZ2dsZU1hcmt1cCh7CiAgICAgICAgc3RhcnQ6ICIqKiIKICAgICAgfSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwoKICAgIF9zZXQoa2V5QmluZGluZ3MsICIiLmNvbmNhdChDdHJsS2V5LCAiLUkiKSwgYyA9PiB7CiAgICAgIHRoaXMudG9nZ2xlTWFya3VwKHsKICAgICAgICBzdGFydDogIioiCiAgICAgIH0pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCAiIi5jb25jYXQoQ3RybEtleSwgIi1BbHQtUmlnaHQiKSwgYyA9PiB7CiAgICAgIGxldCBsdmwgPSB0aGlzLmdldEhlYWRlckxldmVsKGMpOwoKICAgICAgaWYgKGx2bCA+PSA2KSB7CiAgICAgICAgbHZsID0gNTsKICAgICAgfQoKICAgICAgdGhpcy5zZXRIZWFkZXJMaW5lKGx2bCArIDEpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBfc2V0KGtleUJpbmRpbmdzLCAiIi5jb25jYXQoQ3RybEtleSwgIi1BbHQtTGVmdCIpLCBjID0+IHsKICAgICAgbGV0IGx2bCA9IHRoaXMuZ2V0SGVhZGVyTGV2ZWwoYyk7CgogICAgICBpZiAobHZsIDw9IDEpIHsKICAgICAgICBsdmwgPSAyOwogICAgICB9CgogICAgICB0aGlzLnNldEhlYWRlckxpbmUobHZsIC0gMSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwoKICAgIHRoaXMuY20uc2V0T3B0aW9uKCdleHRyYUtleXMnLCBrZXlCaW5kaW5ncyk7CiAgICB0aGlzLmNtLm9uKCdpbnB1dFJlYWQnLCB0aGlzLmF1dG9jb21wbGV0ZSk7IC8vIEhhbmRsZSBjdXJzb3IgbW92ZW1lbnQKCiAgICB0aGlzLmNtLm9uKCdjdXJzb3JBY3Rpdml0eScsIGMgPT4gewogICAgICB0aGlzLnBvc2l0aW9uU3luYyhjKTsKICAgICAgdGhpcy5zY3JvbGxTeW5jKGMpOwogICAgfSk7IC8vIEhhbmRsZSBzcGVjaWFsIHBhc3RlCgogICAgdGhpcy5jbS5vbigncGFzdGUnLCB0aGlzLm9uQ21QYXN0ZSk7IC8vIFJlbmRlciBpbml0aWFsIHByZXZpZXcKCiAgICB0aGlzLnByb2Nlc3NDb250ZW50KHRoaXMuJHN0b3JlLmdldCgnZWRpdG9yL2NvbnRlbnQnKSk7CiAgICB0aGlzLnJlZnJlc2goKTsKICAgIHRoaXMuJHJvb3QuJG9uKCdlZGl0b3JJbnNlcnQnLCBvcHRzID0+IHsKICAgICAgc3dpdGNoIChvcHRzLmtpbmQpIHsKICAgICAgICBjYXNlICdJTUFHRSc6CiAgICAgICAgICBsZXQgaW1nID0gIiFbIi5jb25jYXQob3B0cy50ZXh0LCAiXSgiKS5jb25jYXQob3B0cy5wYXRoLCAiKSIpOwoKICAgICAgICAgIGlmIChvcHRzLmFsaWduICYmIG9wdHMuYWxpZ24gIT09ICcnKSB7CiAgICAgICAgICAgIGltZyArPSAiey5hbGlnbi0iLmNvbmNhdChvcHRzLmFsaWduLCAifSIpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW5zZXJ0QXRDdXJzb3IoewogICAgICAgICAgICBjb250ZW50OiBpbWcKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ0JJTkFSWSc6CiAgICAgICAgICB0aGlzLmluc2VydEF0Q3Vyc29yKHsKICAgICAgICAgICAgY29udGVudDogIlsiLmNvbmNhdChvcHRzLnRleHQsICJdKCIpLmNvbmNhdChvcHRzLnBhdGgsICIpIikKICAgICAgICAgIH0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ0RJQUdSQU0nOgogICAgICAgICAgY29uc3Qgc2VsU3RhcnRMaW5lID0gdGhpcy5jbS5nZXRDdXJzb3IoJ2Zyb20nKS5saW5lOwogICAgICAgICAgY29uc3Qgc2VsRW5kTGluZSA9IHRoaXMuY20uZ2V0Q3Vyc29yKCd0bycpLmxpbmUgKyAxOwogICAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVNlbGVjdGlvbignYGBgZGlhZ3JhbVxuJyArIG9wdHMudGV4dCArICdcbmBgYFxuJywgJ3N0YXJ0Jyk7CiAgICAgICAgICB0aGlzLnByb2Nlc3NNYXJrZXJzKHNlbFN0YXJ0TGluZSwgc2VsRW5kTGluZSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7IC8vIEhhbmRsZSBzYXZlIGNvbmZsaWN0CgogICAgdGhpcy4kcm9vdC4kb24oJ3NhdmVDb25mbGljdCcsICgpID0+IHsKICAgICAgdGhpcy50b2dnbGVNb2RhbCgiZWRpdG9yTW9kYWxDb25mbGljdCIpOwogICAgfSk7CiAgICB0aGlzLiRyb290LiRvbignb3ZlcndyaXRlRWRpdG9yQ29udGVudCcsICgpID0+IHsKICAgICAgdGhpcy5jbS5zZXRWYWx1ZSh0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpOwogICAgfSk7CiAgfSwKCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMuJHJvb3QuJG9mZignZWRpdG9ySW5zZXJ0Jyk7CiAgfQoKfTs="},null]}